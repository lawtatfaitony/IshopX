@using Ishop.Context
@using LanguageResource
@using Microsoft.AspNet.Mvc.Rendering
@model Ishop.Models.Info.InfoDetail
@{
    ViewBag.Title = string.IsNullOrEmpty(ViewBag.CurrentAccountMgrID) ? Lang.Views_GeneralUI_AddNew : Lang.Views_GeneralUI_Update;
    ViewBag.SubTitle = Lang.ModalView_AddUpdateInfo_SubTitle;
}
@Styles.Render("~/AdminLTE/plugins/bootstrap-wysiwyg/css")
@Scripts.Render("~/AdminLTE/plugins/bootstrap-wysiwyg/js")

<link href="~/webuploader/CSS/webuploader.css" rel="stylesheet" />
<script src="~/webuploader/Script/webuploader.js"></script>
<script src="~/js/Info/TreeInfoCateItem.js"></script>
<script src="~/js/Info/SeoHtmlContextAdd.js"></script>
<style>
    label {
        font-size: 1.1em;
    }
    .input_decorate {
        display: inline-block;
        width: 100px;
        height: 100px;
        background: url("@Url.Content("~/images/AddPicture.jpg")");
        background-size: 100px 100px;
        background-repeat: no-repeat;
        position: relative;
        overflow: hidden;
        opacity: 0;
        filter: alpha(opacity=0);
    }
    .input-group{width:98%;max-width:600px;}
    #select_Author input{width:110px; border-right-width:0px}
    #select_Author select{width:170px;border-left-width:0px}
</style>
<div class="box box-info">
    @using (Ajax.BeginForm("AddUpdateInfo", null, new { InfoID = ViewBag.CurrentInfoID }, new AjaxOptions { HttpMethod = "post", OnSuccess = "HandleInfoAddUpdateSuccDialog", OnFailure = "errInfoAddUpdate", LoadingElementId = "Loading" }, new { @class = "form-horizontal" }))
    {
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.AntiForgeryToken()

        @Html.HiddenFor(model => model.ShopID, new { Value = WebCookie.ShopID })<!--隐藏ShpID-->
        @Html.HiddenFor(model => model.CreatedDate, new { Value = DateTime.Now })<!--隐藏CreatedDate-->
        @Html.HiddenFor(model => model.Views)
        <div id="Loading" class="hidden"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span></div>

        <div id="box-widget" class="box-header with-border">
            <h3 class="box-title">@Html.ActionLink(Lang.Views_GeneralUI_Return, "Index")</h3> <div class="pull-right"><a href="#" id="btnInfoCopy" class="pull-right btn-warning btn-sm" style="padding:5px;" >COPY</a> </div>
        </div>
        <div class="box-body">
            <div class="form-group">
                @Html.LabelFor(model => model.Title, htmlAttributes: new { @class = "col-sm-2 control-label" })
                <div class="col-sm-10">
                    <div class="input-group">
                        @Html.TextBoxFor(model => model.Title, new { @class = "form-control dropdown-toggle", autocomplete = "off", data_toggle = "dropdown", placeHolder = Html.DisplayNameFor(model => model.Title), title = Html.DisplayNameFor(model => model.Title), style = "width:98%;max-width:600px;" })
                        @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
                        <div id="DivDownMenu1" class="dropdown-menu" role="menu" style="width:280px;">
                            <div class="pull-right">
                                <span class="fa fa-times" style="padding-right:10px;"></span>
                            </div>
                            <div id="Tree_dropdown_menu1" class="h6 small treeview" style="padding-top:5px;padding-left:5px;padding-right:-10px;">
                                <div id="Tree_dropdown_menu1" class="h6 small treeview " style="padding-top:5px;padding-left:5px;padding-right:-10px;">
                                    <div id="Loading1"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span><br /></div>
                                </div>
                            </div>
                        </div>
                    </div><!--input-group-btn-->
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.InfoCateID, htmlAttributes: new { @class = "col-sm-2 control-label" })
                <div class="col-sm-10">
                    @Html.DropDownList("InfoCateID", Html.InfoCateAndModeDropDownList(Model.InfoCateID), Lang.GeneralUI_Select, new { @class = "form-control", data_toggle = "tooltip", placeHolder = Html.DisplayNameFor(model => model.InfoCateID), title = Html.DisplayNameFor(model => model.InfoCateID) })
                    @Html.ValidationMessageFor(model => model.InfoCateID, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(model => model.InfoItemTemplateIDs, htmlAttributes: new { @class = "col-sm-2 control-label" })
                <div class="col-sm-10">
                    <table>
                        <tr>
                            @{
                                int cnt = 0;
                                List<Ishop.ViewModes.Info.ViewInfoItemTemplateOption> viewInfoItemTemplateOption = ViewBag.List_InfoItemTemplateIDs;

                                foreach (var item in viewInfoItemTemplateOption)
                                {
                                    if (cnt++ % 3 == 0)
                                    {
                                    @: </tr><tr>
                                    }
                                    <td>
                                        <input type="checkbox"
                                               id="selectedInfoItemTemplateIDs"
                                               name="selectedInfoItemTemplateIDs"
                                               value="@item.InfoItemTemplateID"
                                               @(Html.Raw(item.Assigned ? "checked=\"checked\"" : "")) />
                                        @item.InfoItemTemplateName &nbsp;
                                    </td>
                                }
                            @:</tr>
                            } <!--代码段-->
                        </table>
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.TitleThumbNail, htmlAttributes: new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-10">
                        <ul class="list-unstyled list-inline">
                            <li>
                                <a id="OpenDialog" style="width:110px;display:block;">
                                    @if (string.IsNullOrEmpty(Html.DisplayFor(model => model.TitleThumbNail).ToString().Trim()))
                                    {
                                        <img id="uploadPicResult" src="@Url.Content("~/images/AddPicture_a.png")" width="110" class="img-thumbnail" />
                                    }
                                    else
                                    {
                                        <img id="uploadPicResult" src="@Html.DisplayFor(model => model.TitleThumbNail)" alt="@Lang.ModalView_AddUpdateInfo_ClktoChangePicture" width="110" class="img-thumbnail" />
                                    }
                                </a>
                            </li>

                            <li>
                                <input type="file" value="@Lang.Views_GeneralUI_Browse" id="file_uploadPic" SrvUrl="/@LangUtilities.LanguageCode/Utilities/UpLoadProcess2?Prefix=Inf&SubPath=Info&TargetTalbeKeyID=@ViewBag.TempInfoID&ShopID=@WebCookie.ShopID"
                                       mime_type="image/jpeg" accept="image/jpeg" class="input-group-sm hidden" />
                            </li>
                        </ul>
                        @Html.TextBoxFor(model => model.TitleThumbNail, htmlAttributes: new { @class = "hidden" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.ShowTitleThumbNail, htmlAttributes: new { @class = "col-sm-2 control-label", data_toggle = "tooltip", title = Lang.Views_GeneralUI_AddUpdateInfo_ShowTitleThumbNail_Lanbel_title })
                    <div class="col-sm-10 form-inline">
                        @Html.CheckBoxFor(model => model.ShowTitleThumbNail)
                        <label for="ShowTitleThumbNail" class="h6" data_toggle="tooltip" , title="@Lang.ModalView_AddUpdateInfo_IsDisplayTitlePic">（@Lang.ModalView_AddUpdateInfo_IsDisplayTitlePic）</label>
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.SubTitle, htmlAttributes: new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-10">
                        @Html.TextAreaFor(model => model.SubTitle, new { @class = "form-control", data_toggle = "tooltip", rows = "3", multiple = "multiple", placeHolder = Html.DisplayNameFor(model => model.SubTitle), title = Html.DisplayNameFor(model => model.SubTitle), style = "width:98%;max-width:600px;" })
                        @Html.ValidationMessageFor(model => model.SubTitle, "", new { @class = "text-danger" })
                    </div>
                </div>
                <!--描述 begin-->
                <div class="form-group ">
                    @Html.LabelFor(model => model.InfoDescription, htmlAttributes: new { @class = "col-sm-2 control-label", @for = "editor" })
                    <div class="col-sm-10">
                        @Html.TextAreaFor(model => model.InfoDescription, new { @class = "form-control hidden", placeholder = "-" })
                        <!--文本编辑器开始-->
                        <div class="btn-toolbar" data-role="editor-toolbar" data-target="#editor">
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="Font"><i class="fa fa-font" aria-hidden="true"></i><b class="caret"></b></a>
                                <ul class="dropdown-menu"></ul>
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default  btn-sm dropdown-toggle" data-toggle="dropdown" title="Text Highlight Color"><i class="fa fa-paint-brush"></i>&nbsp;<b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    <!--<p>&nbsp;&nbsp;&nbsp;Text Highlight Color:</p>-->
                                    <li class="list-inline" style="background-color:#ebf3f3"><a data-edit="backColor #FFFFFF"><i class="fa fa-stop" style="color:#ebf3f3;font-weight:700;">&nbsp;White</i></a></li>
                                    <li class="list-inline" style="background-color:#ebf3f3"><a data-edit="backColor #00FFFF"><i class="fa fa-stop" style="color:#808080;font-weight:700;">&nbsp;Gray</i></a></li>
                                    <li class="list-inline" style="background-color:#ebf3f3"><a data-edit="backColor #00FFFF"><i class="fa fa-stop" style="color:#00FFFF;font-weight:700;">&nbsp;Blue</i></a></li>
                                    <li class="list-inline" style="background-color:#ebf3f3"><a data-edit="backColor #00FF00"><i class="fa fa-stop" style="color:#00FF00;font-weight:700;">&nbsp;Green</i></a></li>
                                    <li class="list-inline" style="background-color:#ebf3f3"><a data-edit="backColor #FF7F00"><i class="fa fa-stop" style="color:#FF7F00;font-weight:700;">&nbsp;Orange</i></a></li>
                                    <li class="list-inline" style="background-color:#ebf3f3"><a data-edit="backColor #FF0000"><i class="fa fa-stop" style="color:#FF0000;font-weight:700;">&nbsp;Red</i></a></li>
                                    <li class="list-inline" style="background-color:#ebf3f3"><a data-edit="backColor #9a8383"><i class="fa fa-stop" style="color:#9a8383;font-weight:700;">&nbsp;Brown</i></a></li>
                                </ul>
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="Font Size"><i class="fa fa-text-height" aria-hidden="true"></i>&nbsp;<b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    <li><a data-edit="fontSize 7"><font size="7">7</font></a></li>
                                    <li><a data-edit="fontSize 6"><font size="6">6</font></a></li>
                                    <li><a data-edit="fontSize 5"><font size="5">5</font></a></li>
                                    <li><a data-edit="fontSize 4"><font size="4">4</font></a></li>
                                    <li><a data-edit="fontSize 3"><font size="3">3</font></a></li>
                                    <li><a data-edit="fontSize 2"><font size="2">2</font></a></li>
                                    <li><a data-edit="fontSize 1"><font size="1">1</font></a></li>
                                </ul>
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm " data-edit="bold" title="Bold (Ctrl/Cmd+B)"><i class="fa fa-bold" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="italic" title="Italic (Ctrl/Cmd+I)"><i class="fa fa-italic" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="strikethrough" title="Strikethrough"><i class="fa fa-strikethrough" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="underline" title="Underline (Ctrl/Cmd+U)"><i class="fa fa-underline" aria-hidden="true"></i></a>
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm " data-edit="insertunorderedlist" title="Bullet list"><i class="fa fa-list" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="insertorderedlist" title="Number list"><i class="fa fa-list-ol" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="outdent" title="Reduce indent (Shift+Tab)"><i class="fa fa-outdent" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="indent" title="Indent (Tab)"><i class="fa fa-indent" aria-hidden="true"></i></a>
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm " data-edit="justifyleft" title="Align Left (Ctrl/Cmd+L)"><i class="fa fa-align-left" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="justifycenter" title="Center (Ctrl/Cmd+E)"><i class="fa fa-align-center" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="justifyright" title="Align Right (Ctrl/Cmd+R)"><i class="fa fa-align-right" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="justifyfull" title="Justify (Ctrl/Cmd+J)"><i class="fa fa-align-justify" aria-hidden="true"></i></a>
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="Hyperlink"><i class="fa fa-link" aria-hidden="true"></i></a>
                                <div class="dropdown-menu input-append">
                                    <input class="span2" placeholder="URL" type="text" data-edit="createLink" style="max-width:150px" />
                                    <button class="btn btn-default btn-sm " type="button">Add</button>
                                </div>
                                <a class="btn btn-default btn-sm" data-edit="unlink" title="Remove Hyperlink"><i class="fa fa-chain-broken" aria-hidden="true"></i></a>

                            </div>

                            <div class="btn-group">
                                <a class="btn-default btn-sm btn" title="@Lang.Views_GeneralUI_UploadToServer" id="pictureBtn2">
                                    <i class="fa fa-file-image-o" aria-hidden="true">
                                        <input type="file" id="pictureInput" data-Prefix="Ca"
                                               SrvUrl="/@LangUtilities.LanguageCode/Utilities/UpLoadProcess2?Prefix=Inf&SubPath=Info&TargetTalbeKeyID=@ViewBag.TempInfoID&ShopID=@WebCookie.ShopID"
                                               data-role="magic-overlay" data-target="#pictureBtn2" multiple="multiple" accept="image/*" data-edit="insertImage" width="30" />
                                    </i>
                                </a>
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm " data-edit="undo" title="Undo (Ctrl/Cmd+Z)"><i class="fa fa-undo" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="redo" title="Redo (Ctrl/Cmd+Y)"><i class="fa fa-repeat" aria-hidden="true"></i></a>
                            </div>
                            <div class="btn-group">
                                <input type="text" data-edit="inserttext" id="voiceBtn" x-webkit-speech="">
                            </div>

                        </div>
                        <!--文本编辑器结束-->
                        <div id="editor" style="overflow:auto;padding:5px;">
                            @(Html.Raw(ViewBag.vInfoDescription))
                        </div>
                        <input type="button" id="SeoHtmlContext1" data-toggle="modal" data-target="#ModalSeoHtml1" class="btn btn-info btn-flat" value="@Lang.Views_GeneralUI_RichText" title="@Lang.Views_GeneralUI_RichText" />
                        
                        @if (!string.IsNullOrEmpty(ViewBag.CurrentInfoID))
                        {
                            @Html.ActionLink(string.Format("UE{0}", Lang.Views_GeneralUI_Edit.Replace(" ", "")), "InfoEditor", new { InfoID = ViewBag.CurrentInfoID }, new { @class = "fa fa-pencil btn btn-prymary", style = "color:mediumslateblue;word-wrap:normal;word-break:keep-all", target = "_blank" })
                        }
                        
                    </div><!--col-md-10结束-->
                </div>
                <!--描述 end-->

                <div class="form-group">
                    @Html.LabelFor(model => model.VideoUrl, htmlAttributes: new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-10">
                        @Html.TextBoxFor(model => model.VideoUrl, new { @class = "form-control hidden", data_toggle = "tooltip", placeHolder = Lang.Views_GeneralUI_AddUpdateInfo_VideoUrl_placeHolder, title = Lang.Views_GeneralUI_AddUpdateInfo_VideoUrl_title, style = "width:98%;max-width:600px;" })
                        @Html.ValidationMessageFor(model => model.VideoUrl, "", new { @class = "text-danger" })
                        <div id="uploader" class="wu-example">
                            <!--用来存放文件信息-->
                            <div id="fileList" class="uploader-list"></div>
                            <div class="btns">
                                <div id="picker" class="btn btn-default bg-black-gradient">@Lang.InfoCate_InfoCateName</div><div id="fileLoading" class="hidden"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.SeoKeyword, htmlAttributes: new { @class = "col-sm-2 control-label", autocomplete = "off" })
                    <div class="col-sm-10">
                        <div class="input-group">
                            @Html.TextBoxFor(model => model.SeoKeyword, new { @class = "form-control dropdown-toggle", autocomplete = "on", data_toggle = "dropdown", placeHolder = Html.DisplayNameFor(model => model.SeoKeyword), title = Html.DisplayNameFor(model => model.SeoKeyword), style = "width:98%;max-width:600px;" })
                            @Html.ValidationMessageFor(model => model.SeoKeyword, "", new { @class = "text-danger" })

                            <div id="DivDownMenu2" class="dropdown-menu" role="menu" style="width:280px;">
                                <span class="pull-right fa fa-times" style="padding-right:10px;"></span>
                                <div id="Tree_dropdown_menu2" class="h6 small treeview" style="padding-top:5px;padding-left:5px;padding-right:5px;">
                                    <div id="Loading2"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span><br /></div>
                                </div>
                            </div>
                        </div><!--input-group-btn-->
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.SeoDescription, htmlAttributes: new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-10">
                        <div class="input-group">
                            @Html.TextBoxFor(model => model.SeoDescription, new { @class = "form-control dropdown-toggle", autocomplete = "on", data_toggle = "dropdown", placeHolder = Html.DisplayNameFor(model => model.SeoDescription), title = Html.DisplayNameFor(model => model.SeoDescription), style = "width:98%;max-width:600px;" })
                            @Html.ValidationMessageFor(model => model.SeoDescription, "", new { @class = "text-danger" })

                            <div id="DivDownMenu3" class="dropdown-menu" role="menu" style="width:280px;">
                                <span class="pull-right fa fa-times" style="padding-right:10px;"></span>
                                <div id="Tree_dropdown_menu3" class="h6 small treeview" style="padding-top:5px;padding-left:5px;padding-right:5px;">
                                    <div id="Loading3"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span><br /></div>
                                </div>
                            </div>
                        </div><!--input-group-btn-->
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.IsOriginal, htmlAttributes: new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-10">
                        @Html.CheckBoxFor(model => model.IsOriginal, new { @checked = "true", @class = "checkbox" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.LanguageCode, htmlAttributes: new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-5">
                        @Html.DropDownList("LanguageCode", Html.LangEnumCodeDropDownList(Model.LanguageCode.ToString()), Lang.GeneralUI_Select, new { @class = "form-control", data_toggle = "tooltip", placeHolder = Html.DisplayNameFor(model => model.InfoCateID), title = Html.DisplayNameFor(model => model.LanguageCode) })
                        @Html.ValidationMessageFor(model => model.LanguageCode, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-sm-5">
                         <span>@Lang.InfoDetail_LanguageCodeTips</span>
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.Author, htmlAttributes: new { @class = "col-sm-2 control-label" })
                    <div id="select_Author" class="col-sm-7">
                        <div class="input-group">
                            <div class="input-group-addon　no-margin no-padding">
                                @Html.TextBoxFor(model => model.Author, new { @class = "form-control", data_toggle = "tooltip", placeHolder = Lang.Views_GeneralUI_AddUpdateInfo_FilltheNickName + "＞", title = Lang.Views_GeneralUI_AddUpdateInfo_FillNickNameTitle })
                                @Html.DropDownList("ShopStaffID", null, Lang.GeneralUI_Select, new { @class = "form-control input-group-addon", data_toggle = "tooltip", title = Lang.Views_GeneralUI_AddUpdateInfo_ShopStaffID_Title })
                            </div>
                        </div><!--input-group-btn-->
                    </div>
                </div>

            </div>
            <div class="box-footer col-sm-offset-2">
                <ul class="list-inline list-unstyled">
                    <li>
                        <button type="button" id="btnaddnew" class="btn btn-info ">
                            @(string.IsNullOrEmpty(ViewBag.CurrentInfoID) ? Lang.Views_GeneralUI_AddNew : Lang.Views_GeneralUI_Update)
                        </button>
                    </li>
                   
                    <li>
                        @Html.ActionLink(Lang.Views_GeneralUI_Return, "Index", null, new { @class = "btn btn-info" })
                    </li>
                    <li>
                        <input type="button" id="infocatedropdawnTest" value="@Html.DisplayNameFor(model => model.InfoCateID)" title="for test" class="btn btn-info" />
                    </li>
                    <li>
                        <input type="button" id="btn_UploadItem" value="@Lang.Views_GeneralUI_RelateFile" title="for test" class="btn btn-info" />
                    </li>
                    <li>
                        @if (Request.Params["InfoID"] != null)
                        {
                            <button type="button" id="btnDel" class="btn btn-danger">@Lang.Views_GeneralUI_Delete</button>
                        }
                    </li>
                </ul>
            </div>

            <div class="box-title col-sm-offset-2" style="padding-left:15px">
                <ul class="list-unstyled">
                    <li>
                        <p class="box-title"><strong>Rule:For Role: StoreBusinessPromotion </strong></p>
                    </li>
                </ul>
            </div>
        }
</div>

<!--Modal For 信息复制 By InfoId-->
<div class="modal fade" id="InfoCopyModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <span class="modal-title h4" id="input_info_id">INput Info ID</span><a class="badge badge-warning padding-10 margin-left5" target="_blank" href="~/Content/BackEnd/InfoCopyHelpTips.jpg">帮助说明</a>
            </div>
            <div class="modal-body ">
                <div class="row">
                    @using (Html.BeginForm("AddUpdateInfo", "Info", FormMethod.Get, new { @class = "form-horizontal no-padding no-margin " }))
                    {
                        <div id="box-widget" class="box-body form-inline col-lg-8 col-md-8 col-sm-8 col-xs-12 padding-left15">
                            @Html.TextBox("FromInfoID", "", new { @class = "form-control", placeholder = Lang.Views_GeneralUI_InputKeyWord, style = "max-width:120px;" }) 

                            <input type="submit" class="btn btn-info" value="INFO COPY" />  
                            
                        </div>
                    }
                </div><!--Row-->
            </div> 
        </div>
    </div>
</div>

<!-- Modal for 信息类目-->
<div class="modal fade" id="myModal_InfoCate" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <span class="modal-title h4" title="@Html.DisplayNameFor(model => model.InfoCateID)" data-toggle="tooltip" id="myModalLabel_PN_ProDCateName">@Html.DisplayNameFor(model => model.InfoCateID)</span>
            </div>
            <div class="modal-body ">
                <div class="row">
                    <div id="treeviewMenu1" class="treeview"></div>
                </div><!--Row-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" id="Savechanges_AddNew_PropertiesValueName" class="btn btn-primary">@Lang.GeneralUI_OK</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for 相关的图片和视频-->
<div class="modal fade" id="myModal_UploadItem" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <span class="modal-title h4" title="@Lang.ModalView_AddUpdateInfo_ModalSeoHtml_myModalLabel_UploadItem" data-toggle="tooltip" id="myModalLabel_UploadItem">@Lang.ModalView_AddUpdateInfo_ModalSeoHtml_myModalLabel_UploadItem</span>
            </div>
            <div class="modal-body ">
                <div class="row">
                    @{
                        List<Ishop.Models.UploadItem.UploadItem> uploadItems = ViewBag.UploadItemList;
                        if (uploadItems != null)
                        {
                                @:<table class="table"><tr>
                                    int cnt = 0;
                                    foreach (var item in uploadItems)
                                    {
                                        if (cnt++ % 1 == 0)
                                        {
                                        @:</tr><tr>
                                        }
                                        <td>
                                            <a id="Rawname" href="@item.Url" target="_blank" class="btn-large  active">@item.RawName</a>&nbsp;&nbsp;<a id="@item.UploadItemId" href="javascript:del_uploadItem('@item.UploadItemId')">删 除</a>
                                        </td>
                                    }
                                @:</tr></table>
                            }
                    }
                </div><!--Row-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script src="~/AdminLTE/plugins/bootstrap-wysiwyg/js/bootstrap-wysiwyg-ini-editor2.js"></script>
<!-- Modal for 关键词富文本HTML5模板-->
<div id="ModalSeoHtml1" class="modal fade" tabindex="-2" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <span class="modal-title h4" title="关键词富文本HTML5模板" data-toggle="tooltip" id="ModalSeoHtml_Title">@Lang.ModalView_AddUpdateInfo_ModalSeoHtml_Title_text</span>
            </div>
            <div class="modal-body ">
                <div class="row">
                    <div class="col-md-5 col-sm-5 col-xm-5 col-lg-5" style="padding-left:5px;padding-right:5px;padding-top:0px;">
                        <div id="ModalSeoHtml_Tree_dropdown_menu" class="treeview h6"></div>
                    </div>
                    <div class="col-md-7 col-sm-7 col-xm-7 col-lg-7" style="padding-left:5px;padding-right:5px;">
                        <!--ModalSeoHtml文本编辑器开始-->
                        <div class="btn-toolbar" data-role="editor-toolbar" data-target="#editor2">
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="Font"><i class="fa fa-font" aria-hidden="true"></i><b class="caret"></b></a>
                                <ul class="dropdown-menu"></ul>
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="Font Size"><i class="fa fa-text-height" aria-hidden="true"></i>&nbsp;<b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    <li><a data-edit="fontSize 7"><font size="7">7</font></a></li>
                                    <li><a data-edit="fontSize 6"><font size="6">6</font></a></li>
                                    <li><a data-edit="fontSize 5"><font size="5">5</font></a></li>
                                    <li><a data-edit="fontSize 4"><font size="4">4</font></a></li>
                                    <li><a data-edit="fontSize 3"><font size="3">3</font></a></li>
                                    <li><a data-edit="fontSize 2"><font size="2">2</font></a></li>
                                    <li><a data-edit="fontSize 1"><font size="1">1</font></a></li>
                                </ul>
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm " data-edit="bold" title="Bold (Ctrl/Cmd+B)"><i class="fa fa-bold" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="italic" title="Italic (Ctrl/Cmd+I)"><i class="fa fa-italic" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="strikethrough" title="Strikethrough"><i class="fa fa-strikethrough" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="underline" title="Underline (Ctrl/Cmd+U)"><i class="fa fa-underline" aria-hidden="true"></i></a>
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="Hyperlink"><i class="fa fa-link" aria-hidden="true"></i></a>
                                <div class="dropdown-menu input-append">
                                    <input class="span2" placeholder="URL" type="text" data-edit="createLink" style="max-width:150px" />
                                    <button class="btn btn-default btn-sm " type="button">Add</button>
                                </div>
                                <a class="btn-default btn-sm btn" title="@Lang.Views_GeneralUI_UploadToServer" id="pictureBtn2">
                                    <i class="fa fa-file-image-o" aria-hidden="true">
                                    </i>
                                </a>
                                <input type="file" id="pictureInput" data-Prefix="Ca"
                                       SrvUrl="/@LangUtilities.LanguageCode/Utilities/UpLoadProcess2?Prefix=Inf&SubPath=Info&TargetTalbeKeyID=@ViewBag.TempInfoID&ShopID=@WebCookie.ShopID"
                                       data-role="magic-overlay" data-target="#pictureBtn2" multiple="multiple" accept="image/*" data-edit="insertImage" width="30" />
                            </div>
                            <div class="btn-group">
                                <a class="btn btn-default btn-sm " data-edit="justifyleft" title="Align Left (Ctrl/Cmd+L)"><i class="fa fa-align-left" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="justifycenter" title="Center (Ctrl/Cmd+E)"><i class="fa fa-align-center" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="justifyright" title="Align Right (Ctrl/Cmd+R)"><i class="fa fa-align-right" aria-hidden="true"></i></a>
                                <a class="btn btn-default btn-sm " data-edit="justifyfull" title="Justify (Ctrl/Cmd+J)"><i class="fa fa-align-justify" aria-hidden="true"></i></a>
                            </div>

                        </div><!--ModalSeoHtml文本编辑器结束-->
                        <div id="editor2" style="overflow:auto;max-height:350px;height:350px;padding:5px;">
                            <span class="bg-black-gradient">@Lang.ModalView_AddUpdateInfo_bg_black_gradient_text</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="h6 col-md-7 col-sm-7 col-xm-7 col-lg-7 col-md-offset-5 col-sm-offset-5 col-lg-offset-5"><span>@Lang.ModalView_AddUpdateInfo_bg_black_gradient_text</span></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" id="btn_append1" class="btn btn-primary">@Lang.ModalView_AddUpdateInfo_btn_append1_text</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    
    $("#btnInfoCopy").click(function () { $("#InfoCopyModal").modal({ backdrop: 'static' }); }); //弹出 信息复制

    $("#infocatedropdawnTest").click(function () { $("#myModal_InfoCate").modal({ backdrop: 'static' }); }); //弹出 信息类目Dialog
    $("#btn_UploadItem").click(function () { $("#myModal_UploadItem").modal({ backdrop: 'static' }); }); //弹出 相关的图片和视频
    function HandleInfoAddUpdateSuccDialog(data)
    {
        if (data.MsgCode === "1")  // 输入数据格式非法
        {
            BootstrapDialog.show({
                type: BootstrapDialog.TYPE_SUCCESS,
                resizable: true,
                size: 'size-normal',
                closeByBackdrop: false,
                closeByKeyboard: false,
                draggable: true,
                closable: false,
                title: $("#LoginID").val() + "-" + $("#WebSite").val(),
                message: "<H3>" + data.Message + "</H3>",
                cssClass: 'bootstrap-dialog fade',
                buttons: [{
                    label: 'OK!',
                    cssClass: 'btn-primary',
                    action: function (dialog) {
                        golist();
                        dialog.close();
                    }
                }]
            });
        } else {
            alert("server handle data fail \n\n" + data.MsgCode + ":" + data.Message);
        }
    }
    function golist()
    {
        window.location = "@Url.Content("index")";
    }
    function errInfoAddUpdate(data) {
        alert(data.MsgCode + "::" + data.Message);
    }
</script>
<!--删除操作-->
<script>
    $("#btnDel").click(function () {

        return BootstrapDialog.show({
            cssClass: 'bootstrap-dialog fade',
            title: $("#Title").val() + "@@" + $("#ShopID").val(),
            message: "@Html.DisplayNameFor(model=>model.SubTitle)" + $("#SubTitle").val(),
            buttons: [{
                label: '@Lang.Views_GeneralUI_Delete',
                action: function (dialog) {
                    console.log("del....");
                    DelInfoDetail("@ViewBag.CurrentInfoID");  //调用删除操作函数
                    dialog.close();
                }
            }, {
                label: '@Lang.Views_GeneralUI_Cancel',
                action: function (dialog) {
                    dialog.close();
                    return false;
                }
            }]
        });//BootstrapDialog
    });// click

    function DelInfoDetail(Delete) {
        var url = "@Url.Content("Delete")";
        var InfoID = "@ViewBag.CurrentInfoID";
        var myparamsObject = { "InfoID": InfoID };
        $.ajax({
            type: "post",
            data: JSON.stringify(myparamsObject),
            url: url,
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data.MsgCode !== "1")  // 输入数据格式非法
                {
                    alert("delete error:data.MsgCode=" + data.MsgCode);
                    return;
                }

                BootstrapDialog.show({
                    cssClass: 'bootstrap-dialog fade',
                    title: "@Lang.Views_GeneralUI_ReturnResult",
                    message: "<H3>" + data.Message + "</H3>",
                    buttons: [{
                        label: 'OK',
                        action: function (dialog) {
                            dialog.close();
                            golist();
                        }
                    }]
                });//BootstrapDialog
            },
            error: function (err) {
                console.log(JSON.stringify(err));
                alert("delete error:" + JSON.stringify(err));
            }
        });

    }
</script>

<script>

    $(document).ready(function () {
        //--begin Modal for 关键词富文本HTML5模板-- ---------------------------------------------------------------------
        $('#ModalSeoHtml1').on('shown.bs.modal', function () {
            $('#editor2').focus()
        });
        $("#SeoHtmlContext1").click(function (e) {
            //参数
            forRetriveNodeHtml5 = "#editor2";
            TreeViewID = "#ModalSeoHtml_Tree_dropdown_menu";
            $(TreeViewID).slimscroll({
                disableFadeOut: false,
                height: '410px'
            });
            LoadSeoExtandsForEditor(TreeViewID, forRetriveNodeHtml5);
        });
        //富文本附加到编辑器
        $("#btn_append1").click(function (e) {
            $("#ModalSeoHtml1").modal('hide')
            //参数
            $("#editor").html($("#editor").html() + $('#editor2').html());
            $("#editor").focus()
        });

        //--end ---------------------------------------------------------------------------------------------------------

        //【标题】（js文件： SeoHtmlContextAdd.js）
        $("#Title").click(function (e) {

            //参数
            DropdownMenuID = "#DivDownMenu1";
            Tree_DropdownMenuID = "#Tree_dropdown_menu1";
            forNodeTxt = "#Title";
            $(Tree_DropdownMenuID).slimscroll({
                disableFadeOut: false,
                height: '300px'
            });
            LoadSeoExtandsForAddUpdateInfo(DropdownMenuID, Tree_DropdownMenuID, forNodeTxt);

        });
        //【关键字】（js文件： SeoHtmlContextAdd.js）
        $("#SeoKeyword").click(function (e) {
            //参数
            DropdownMenuID = "#DivDownMenu2";
            Tree_DropdownMenuID = "#Tree_dropdown_menu2";
            forNodeTxt = "#SeoKeyword";
            $(Tree_DropdownMenuID).slimscroll({
                disableFadeOut: false,
                height: '300px'
            });
            LoadSeoExtandsForAddUpdateInfo(DropdownMenuID, Tree_DropdownMenuID, forNodeTxt);
        });

        //【关键字描述】（js文件： SeoHtmlContextAdd.js）
        $("#SeoDescription").click(function (e) {
            //参数
            DropdownMenuID = "#DivDownMenu3";
            Tree_DropdownMenuID = "#Tree_dropdown_menu3";
            forNodeTxt = "#SeoDescription";
            $(Tree_DropdownMenuID).slimscroll({
                disableFadeOut: false,
                height: '300px'
            });
            LoadSeoExtandsForAddUpdateInfo(DropdownMenuID, Tree_DropdownMenuID, forNodeTxt);
        });

        //选择作者
        $("#ShopStaffID").change(function () {
            $("#Author").val($("#ShopStaffID").find("option:selected").text());
        });

        //信息类目初始化
        LoadInfoCateData("#treeviewMenu1", "0"); //初始化类目视图
        $('#treeviewMenu1').slimscroll({
            disableFadeOut: false
        });

        $('[data-toggle="tooltip"]').tooltip(); //初始化提示样式
        //确认提交
        $("#btnaddnew").click(function () {
            $("img").addClass("img-responsive");
            var HtmlInfoDescription = $("#editor").html();
            //alert(escape(HtmlInfoDescription));
            $("#InfoDescription").val(escape(HtmlInfoDescription));

            return BootstrapDialog.show({
                cssClass: 'bootstrap-dialog fade',
                title: $("#Title").val() + "\-" + $("#ShopID").val(),
                message: "@Html.DisplayNameFor(model => model.SubTitle):" + $("#SubTitle").val(),
                buttons: [{
                    label: '@Lang.Views_GeneralUI_Submit',
                    action: function (dialog) {
                        console.log("Submit....");
                        $("#btnaddnew").submit();
                        dialog.close();
                    }
                }, {
                    label: '@Lang.Views_GeneralUI_Cancel',
                    action: function (dialog) {
                        dialog.close();
                        return false;
                    }
                }]
            });//BootstrapDialog

        }) // click

    }) //ready
</script>

<!--图片上存-->
<script>
    $("#OpenDialog").click(function () {
        console.log("OpenDialog to select file");
        $("#file_uploadPic").click();
    });
    $("#file_uploadPic").change(function uploadPic() {
        $("#Loading").removeClass("hidden");
        var fileInfo = document.getElementById("file_uploadPic").files[0];
        var SrvUrl = $("#file_uploadPic").attr('SrvUrl');
        console.log("title picture to upload::" + SrvUrl);

        var form = new FormData();
        form.append("file", fileInfo);
        var xhr = new XMLHttpRequest();
        xhr.open("post", SrvUrl, false);// 必需等于 false(异步) 否则出错 ;html>input 属性 SrvUrl = "/Utilities/UpLoadProcess2?Prefix=SC&SubPath=Category&TargetTalbeKeyID=0&ShopID=Shp00001"
        xhr.send(form);
        if (xhr.responseText === "0") {
            alert("error\n no any file recieved! \n" + xhr.responseText);
        }
        else {
            $("#Loading").addClass("hidden");
             
            $("#TitleThumbNail").val(xhr.responseText);
            $("#uploadPicResult").attr("src", xhr.responseText);
        }
         
        console.log(xhr.responseText);

    });

</script>
<!--视频上存-->
<script>
    //获取应用程序根路径
    //var applicationPath = window.applicationPath === "" ? "" : window.applicationPath || "../../";
    $(function () {
        var $ = jQuery,
        $list = $('#fileList'),
        // Web Uploader实例
        uploader = WebUploader.create({
            // 选完文件后，是否自动上传。
            auto: true,
            // swf文件路径
            swf: '/webuploader/Script/Uploader.swf',

            // 文件接收服务端。
            server: '/' + '@LangUtilities.LanguageCode' + '/Utilities/UpLoadProcessFile',    // '@Url.Action("UpLoadProcessFile", "Utilities")',

            // 选择文件的按钮。可选。
            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
            pick: '#picker',
            accept: {
                title: 'html',
                extensions: 'mp4',
                mimeTypes: 'video/mpeg,video/mp4'  // '视频格式'
            }
        });

        // 当有文件添加进来的时候
        uploader.on('fileQueued', function (file) {
            // 初始化以后添加 参数传入  Prefix, string SubPath, string TargetTalbeKeyID, string ShopID

            uploader.options.formData.Prefix = 'Info';
            uploader.options.formData.SubPath = 'Mp4';
            uploader.options.formData.TargetTalbeKeyID = '@ViewBag.TempInfoID';
            uploader.options.formData.shopID = '@WebCookie.ShopID';
            uploader.options.formData.name = file.name;
            uploader.options.formData.type = file.type;
            uploader.options.formData.AcceptType = 'image/jpeg,image/gif,image/png,image/bmp,video/mpeg,video/mp4,application/msword,application/vnd.ms-excel,application/mspowerpoint,text/plain,application/pdf,application/zip,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'; //可以接受的文件类型 AcceptType;
            console.log(JSON.stringify(uploader.options))

            $list.append('<div id="' + file.id + '" class="item">' +
                '<h4 class="info">' + file.name + '</h4>' +
                '<p class="state">@Lang.Views_GeneralUI_Uploading.</p>' +
            '</div>');
            $("#fileLoading").removeClass("hidden");
        });
        // 文件上传过程中创建进度条实时显示。
        uploader.on('uploadProgress', function (file, percentage) {
            var $li = $('#' + file.id),
                $percent = $li.find('.progress span');
            $percent.css('width', percentage * 100 + '%');
            // 避免重复创建
            if (!$percent.length) {
                $percent = $('<p class="progress"><span></span></p>')
                        .appendTo($li)
                        .find('span');
            }

            $percent.css('width', percentage * 100 + '%');
        });

        // 文件上传成功，给item添加成功class, 用样式标记上传成功。
        uploader.on('uploadSuccess', function (file, response) {

            $("#VideoUrl").val(response.filePath.toString());// VideoUrl字段赋值 （reserve）
            InsHtml5Video(response.filePath.toString());//插入视频

            console.log(response.filePath);
            // $("#FooterTemplate").val(response.filePath);
            console.log("FooterTemplate=" + response.filePath);
            //alert("uploadSuccess" + response.filePath);
            $('#' + file.id).find('p.state').text('@Lang.Views_GeneralUI_UploadConpleted');

            $("#fileLoading").addClass("hidden");
        });

        uploader.on('uploadError', function (file) {
            $('#' + file.id).find('p.state').text('@Lang.Views_GeneralUI_UploadError' + response.message);
        });

        uploader.on('uploadComplete', function (file) {
            $('#' + file.id).find('.progress').fadeOut();
        });

        //所有文件上传完毕
        uploader.on("uploadFinished", function (response) {
            //提交表单
            //$("#submit1").click();
            //alert("提交表单" + response.filePath);
        });

    });
</script>
<!--Insert video template-->
<script>
    function InsHtml5Video(VideoPath) {
        var VideaHtml5 = '<br/><video autoplay="false" controls="controls" width="90%"><source src="' + VideoPath + '" type="video/mp4"></video>';
        $("#editor").html($("#editor").html() + VideaHtml5);
        $("#editor").focus();
    }
</script>
